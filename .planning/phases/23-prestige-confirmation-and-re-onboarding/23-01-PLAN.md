---
phase: 23-prestige-confirmation-and-re-onboarding
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/ui/prestigeSummary.ts
  - src/ui/components/PrestigeSummary.tsx
  - tests/prestige-summary.unit.test.tsx
autonomous: true

must_haves:
  truths:
    - "Players see consistent Gain/Keep/Lose wording across prestige tiers"
    - "Summary copy reflects the actual gains shown in prestige confirmations"
  artifacts:
    - path: "src/ui/prestigeSummary.ts"
      provides: "typed prestige summary builders for workshop/maison/nostalgia"
    - path: "src/ui/components/PrestigeSummary.tsx"
      provides: "presentational Gain/Keep/Lose renderer"
    - path: "tests/prestige-summary.unit.test.tsx"
      provides: "unit coverage for summary builders"
  key_links:
    - from: "tests/prestige-summary.unit.test.tsx"
      to: "src/ui/prestigeSummary.ts"
      via: "unit tests"
      pattern: "build(Workshop|Maison|Nostalgia)PrestigeSummary"
    - from: "src/ui/components/PrestigeSummary.tsx"
      to: "src/ui/prestigeSummary.ts"
      via: "imports summary types"
      pattern: "PrestigeSummary"
---

<objective>
Create a shared, typed Gain/Keep/Lose prestige summary that can be rendered consistently across Atelier, Maison, and Nostalgia.

Purpose: PRES-01 requires a clear, trustworthy pre-prestige summary; centralizing the summary definitions keeps UI copy aligned with the real reset semantics in `src/game/actions/index.ts`.
Output: `build*PrestigeSummary()` helpers, a `PrestigeSummary` component, and unit tests.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-prestige-confirmation-and-re-onboarding/23-RESEARCH.md

@src/game/actions/index.ts
@src/ui/tabs/WorkshopTab.tsx
@src/ui/tabs/MaisonTab.tsx
@src/ui/tabs/NostalgiaTab.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add typed prestige summary builders</name>
  <files>src/ui/prestigeSummary.ts</files>
  <action>
Create a new module exporting:
- `type PrestigeTier = "workshop" | "maison" | "nostalgia"`.
- `type PrestigeSummary = { tier: PrestigeTier; title: string; gain: string[]; keep: string[]; lose: string[] }`.
- `buildWorkshopPrestigeSummary(gainBlueprints: number): PrestigeSummary`.
- `buildMaisonPrestigeSummary(gainHeritage: number, gainReputation: number): PrestigeSummary`.
- `buildNostalgiaPrestigeSummary(gainNostalgia: number): PrestigeSummary`.

Derive Keep/Lose lists directly from current action semantics in `src/game/actions/index.ts`:
- Workshop prestige (`prestigeWorkshop`) resets currency/enjoyment/items/upgrades, keeps workshop upgrades + crafting parts/boosts + Maison/Nostalgia progress.
- Maison prestige (`prestigeMaison`) resets currency/enjoyment/items/upgrades + workshop progress/upgrades, keeps Maison upgrades/lines + crafting parts/boosts + Nostalgia progress.
- Nostalgia prestige (`prestigeNostalgia`) resets currency/enjoyment/career + upgrades + workshop + maison + events + crafting, keeps owned watches + catalog discoveries + achievements + nostalgia unlocks.

Keep lists concise (player-facing, not every field), but include the highest-impact items so the summary is trustworthy.
  </action>
  <verify>pnpm run typecheck</verify>
  <done>`src/ui/prestigeSummary.ts` compiles and exports the three `build*PrestigeSummary()` helpers.</done>
</task>

<task type="auto">
  <name>Task 2: Add a reusable PrestigeSummary renderer</name>
  <files>src/ui/components/PrestigeSummary.tsx</files>
  <action>
Create `src/ui/components/PrestigeSummary.tsx` and (if needed) `src/ui/components/` directory.

Implement a pure presentational component:
- Props: `{ summary: PrestigeSummary; testId?: string }`.
- Render 3 cards or sections labeled `Gain`, `Keeps`, `Loses` using existing layout primitives (`card-stack`, `card`, `card-actions` as appropriate).
- Each section renders bullets from `summary.gain/keep/lose`.
- If `testId` provided, apply it to a wrapper element, and add stable sub-ids like `${testId}-gain`, `${testId}-keep`, `${testId}-lose` on the three sections.

Do not introduce new modal libraries or styling frameworks.
  </action>
  <verify>pnpm run typecheck</verify>
  <done>`PrestigeSummary` renders Gain/Keep/Lose from data without accessing game state.</done>
</task>

<task type="auto">
  <name>Task 3: Add unit coverage for prestige summary mapping</name>
  <files>tests/prestige-summary.unit.test.tsx</files>
  <action>
Add a Vitest unit test file that imports the three `build*PrestigeSummary()` helpers and asserts:
- Each builder returns the expected `tier` value.
- `gain` includes the passed-in numeric values (e.g., `+3 Blueprints`, `+2 Heritage`, `+1 Reputation`, `+4 Nostalgia`).
- `keep` and `lose` include at least 2-3 high-signal entries per tier (string contains checks).

Prefer small, stable expectations (avoid snapshot tests).
  </action>
  <verify>pnpm run test:unit -- tests/prestige-summary.unit.test.tsx</verify>
  <done>Unit tests pass and make it hard for summary semantics to drift accidentally.</done>
</task>

</tasks>

<verification>
- `pnpm run typecheck`
- `pnpm run test:unit -- tests/prestige-summary.unit.test.tsx`
</verification>

<success_criteria>
- A single source of truth exists for Gain/Keep/Lose copy for workshop/maison/nostalgia prestiges.
- Summary is typed and unit-tested so future changes to prestige semantics force updating the UI summary intentionally.
</success_criteria>

<output>
After completion, create `.planning/phases/23-prestige-confirmation-and-re-onboarding/23-01-SUMMARY.md`
</output>
