---
phase: 23-prestige-confirmation-and-re-onboarding
plan: 02
type: execute
wave: 2
depends_on:
  - 23-01
files_modified:
  - src/ui/tabs/WorkshopTab.tsx
  - src/ui/tabs/MaisonTab.tsx
  - src/ui/tabs/NostalgiaTab.tsx
  - tests/prestige-summary.unit.test.tsx
autonomous: true

must_haves:
  truths:
    - "Before confirming Atelier or Maison prestige, user can read a Gain/Keep/Lose summary and can cancel safely"
    - "Before confirming Nostalgia prestige, user can read the same Gain/Keep/Lose summary and can cancel safely"
  artifacts:
    - path: "src/ui/tabs/WorkshopTab.tsx"
      provides: "Atelier prestige flow with Gain/Keep/Lose summary"
    - path: "src/ui/tabs/MaisonTab.tsx"
      provides: "Maison prestige flow with Gain/Keep/Lose summary"
    - path: "src/ui/tabs/NostalgiaTab.tsx"
      provides: "Nostalgia prestige flow with Gain/Keep/Lose summary"
  key_links:
    - from: "src/ui/tabs/WorkshopTab.tsx"
      to: "src/ui/prestigeSummary.ts"
      via: "imports summary builder"
      pattern: "buildWorkshopPrestigeSummary"
    - from: "src/ui/tabs/MaisonTab.tsx"
      to: "src/ui/prestigeSummary.ts"
      via: "imports summary builder"
      pattern: "buildMaisonPrestigeSummary"
    - from: "src/ui/tabs/NostalgiaTab.tsx"
      to: "src/ui/prestigeSummary.ts"
      via: "imports summary builder"
      pattern: "buildNostalgiaPrestigeSummary"
---

<objective>
Integrate the shared Gain/Keep/Lose summary into each prestige UI so users can review what changes before committing, and back out without resetting.

Purpose: Satisfies PRES-01 across all prestige tiers by making the confirmation experience explicit and consistent.
Output: Updated Workshop/Maison armed-confirm sections and updated Nostalgia panel + modal to render `PrestigeSummary`.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-prestige-confirmation-and-re-onboarding/23-RESEARCH.md

@src/ui/prestigeSummary.ts
@src/ui/components/PrestigeSummary.tsx
@src/ui/tabs/WorkshopTab.tsx
@src/ui/tabs/MaisonTab.tsx
@src/ui/tabs/NostalgiaTab.tsx
@src/game/actions/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Gain/Keep/Lose summary to Atelier and Maison confirmations</name>
  <files>
src/ui/tabs/WorkshopTab.tsx
src/ui/tabs/MaisonTab.tsx
  </files>
  <action>
In `src/ui/tabs/WorkshopTab.tsx`:
- Import `buildWorkshopPrestigeSummary` + `PrestigeSummary`.
- When `showWorkshopPanel` is true, render a Gain/Keep/Lose summary near the reset CTA (either always visible or only when `workshopResetArmed` is true).
- Use `buildWorkshopPrestigeSummary(workshopPrestigeGain)` so the gain value matches the actual `prestigeWorkshop(..., workshopPrestigeGain)` call.
- Add a stable wrapper test id: `data-testid="workshop-prestige-summary"`.
- When confirming the reset, call `onPurchase(prestigeWorkshop(...), { prestigeTier: "workshop" })`.

In `src/ui/tabs/MaisonTab.tsx`:
- Import `buildMaisonPrestigeSummary` + `PrestigeSummary`.
- Render the summary near the `Prestige atelier` CTA.
- Use `buildMaisonPrestigeSummary(maisonPrestigeGain, maisonReputationGain)`.
- Add a stable wrapper test id: `data-testid="maison-prestige-summary"`.
- When confirming prestige, call `onPurchase(prestigeMaison(...), { prestigeTier: "maison" })`.

Do not change the existing two-step armed confirm pattern; the Cancel button must only disarm (no state changes).
  </action>
  <verify>pnpm run typecheck</verify>
  <done>Atelier and Maison panels show Gain/Keep/Lose summaries alongside existing confirm/cancel controls (behavior verified in 23-03 e2e).</done>
</task>

<task type="auto">
  <name>Task 2: Replace Nostalgia reset lists with the shared summary (panel + modal)</name>
  <files>src/ui/tabs/NostalgiaTab.tsx</files>
  <action>
In `src/ui/tabs/NostalgiaTab.tsx`:
- Import `buildNostalgiaPrestigeSummary` + `PrestigeSummary`.
- Replace the current "Resets" / "Keeps" cards with the shared Gain/Keep/Lose summary driven by `buildNostalgiaPrestigeSummary(nostalgiaPrestigeGain)`.
- In the confirmation modal (`data-testid="nostalgia-modal"`), replace the ad-hoc list with the same shared summary (or reuse the same `PrestigeSummary` with a compact layout).
- Preserve existing `data-testid` attributes (`nostalgia-prestige`, `nostalgia-modal`, `nostalgia-results`, etc.).
- Add a stable wrapper test id for the summary: `data-testid="nostalgia-prestige-summary"`.
- Preserve cancel/back-out semantics: Cancel closes the modal and does not reset state.
- When confirming prestige, call `onPurchase(prestigeNostalgia(...), { prestigeTier: "nostalgia" })`.

Do not introduce new persistence; this is UI-only.
  </action>
  <verify>pnpm run typecheck</verify>
  <done>Nostalgia prestige confirmation uses the shared Gain/Keep/Lose structure (behavior verified in 23-03 e2e).</done>
</task>

<task type="auto">
  <name>Task 3: Validate the prestige summary integration with unit tests</name>
  <files>tests/prestige-summary.unit.test.tsx</files>
  <action>
If any summary strings needed to change during integration, update `tests/prestige-summary.unit.test.tsx` expectations to match.
  </action>
  <verify>pnpm run test:unit -- tests/prestige-summary.unit.test.tsx</verify>
  <done>Unit tests pass after UI integration changes (no drift between planned and used summary semantics).</done>
</task>

</tasks>

<verification>
- `pnpm run typecheck`
- `pnpm run test:unit -- tests/prestige-summary.unit.test.tsx`
</verification>

<success_criteria>
- All three prestige tiers show a clear Gain/Keep/Lose summary before confirmation.
- All three prestige tiers provide a safe back-out path that does not commit the reset.
</success_criteria>

<output>
After completion, create `.planning/phases/23-prestige-confirmation-and-re-onboarding/23-02-SUMMARY.md`
</output>
