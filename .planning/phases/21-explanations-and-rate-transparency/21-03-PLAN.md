---
phase: 21-explanations-and-rate-transparency
plan: 03
type: execute
wave: 2
depends_on:
  - 21-02
files_modified:
  - src/ui/tabs/CollectionTab.tsx
autonomous: true

must_haves:
  truths:
    - "When a purchase is blocked, the UI tells the player what is missing (cash or enjoyment)"
    - "The player can open an explanation of enjoyment gates vs cash spend from the blocked state"
  artifacts:
    - path: "src/ui/tabs/CollectionTab.tsx"
      provides: "Gate messaging for both enjoyment and cash blocks + Explain trigger"
  key_links:
    - from: "src/ui/tabs/CollectionTab.tsx"
      to: "src/ui/help/ExplainButton.tsx"
      via: "ExplainButton(sectionId=HELP_SECTION_IDS.gates)"
      pattern: "HELP_SECTION_IDS\\.gates"
---

<objective>
Make purchase gating transparent at point-of-failure: always show whether a purchase is blocked by cash or enjoyment, and link to a short explanation.

Purpose: Satisfy GUIDE-03 and remove the current "cash blocks are silent" pitfall.
Output: Updated Vault purchase cards with consistent gate messaging + Explain affordance.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/21-explanations-and-rate-transparency/21-RESEARCH.md

@src/ui/tabs/CollectionTab.tsx
@src/game/selectors/index.ts
@src/ui/help/ExplainButton.tsx
@src/ui/help/helpContent.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Show gate messaging + ExplainButton for both cash and enjoyment blocks</name>
  <files>src/ui/tabs/CollectionTab.tsx</files>
  <action>
Update the purchase gate UI inside the watch item cards:

- Keep the existing `data-testid={\`purchase-gate-${item.id}\`}` stable.
- Expand rendering so the gate badge appears whenever `unlocked && !singleGate.ok` (both blocksBy="enjoyment" and blocksBy="cash").

For `blocksBy === "enjoyment"`:
- Show both the requirement and the deficit, e.g. "Requires $X enjoyment (need $Y more)".

For `blocksBy === "cash"`:
- Show the deficit, e.g. "Need $Y more dollars".

In both cases:
- Add an inline `<ExplainButton sectionId={HELP_SECTION_IDS.gates} ... />` so the player can learn the difference between gates and spend.
- Keep the badge compact (single line if possible); no hover-only UI.

Do NOT change the underlying purchase gating logic (`getWatchPurchaseGate`); this is purely explanatory UI.
  </action>
  <verify>pnpm -s run test:e2e -- tests/collection-loop.spec.ts</verify>
  <done>
- The purchase gate badge appears for both enjoyment and cash blocks.
- Clicking the ExplainButton opens Help to the gates section.
- Existing Playwright test "enjoyment gate locks classic purchase" still passes.
  </done>
</task>

</tasks>

<verification>
- `pnpm -s run typecheck`
- `pnpm -s run test:e2e -- tests/collection-loop.spec.ts`
</verification>

<success_criteria>
- Players can distinguish "need more dollars" vs "need more enjoyment" directly on the blocked purchase.
- A tap/click explanation is available from the gate state.
</success_criteria>

<output>
After completion, create `.planning/phases/21-explanations-and-rate-transparency/21-03-SUMMARY.md`
</output>
