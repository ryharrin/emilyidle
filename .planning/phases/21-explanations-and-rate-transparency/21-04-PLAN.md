---
phase: 21-explanations-and-rate-transparency
plan: 04
type: execute
wave: 2
depends_on:
  - 21-01
  - 21-02
files_modified:
  - src/ui/tabs/StatsTab.tsx
autonomous: true

must_haves:
  truths:
    - "User can view a basic rate breakdown (base + modifiers) for enjoyment and cash"
    - "Rate breakdown includes event multiplier, softcap, and therapist income in a readable way"
  artifacts:
    - path: "src/ui/tabs/StatsTab.tsx"
      provides: "Rate breakdown UI with accessible disclosure"
  key_links:
    - from: "src/ui/tabs/StatsTab.tsx"
      to: "src/game/state.ts"
      via: "getCashRateBreakdown/getEnjoymentRateBreakdown"
      pattern: "get(Cash|Enjoyment)RateBreakdown"
---

<objective>
Add an in-place, tap-friendly breakdown for cash/sec and enjoyment/sec so players can see base + modifiers without leaving Stats.

Purpose: Deliver CLAR-03 and reduce confusion around events, softcap efficiency, and therapist salary.
Output: StatsTab disclosure UI powered by selector-level breakdowns.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/21-explanations-and-rate-transparency/21-RESEARCH.md

@src/ui/tabs/StatsTab.tsx
@src/game/selectors/index.ts
@src/game/format.ts
@src/ui/help/ExplainButton.tsx
@src/ui/help/helpContent.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add cash and enjoyment rate breakdown disclosures</name>
  <files>src/ui/tabs/StatsTab.tsx</files>
  <action>
Update `src/ui/tabs/StatsTab.tsx` to render a basic breakdown for enjoyment/sec and dollars/sec.

Requirements:
- Use selector breakdowns (no UI math):
  - `getEnjoymentRateBreakdown(state, currentEventMultiplier)`
  - `getCashRateBreakdown(state, currentEventMultiplier)`

- Present breakdown using tap-friendly disclosure:
  - Use native `<details>/<summary>` blocks.
  - Add `data-testid="enjoyment-rate-breakdown"` and `data-testid="cash-rate-breakdown"` on the `<details>` elements.

- Keep it readable:
  - Show the effective rate first.
  - Show base addend and a short list of multiplier terms (label + xN.NN).
  - For cash: show softcap efficiency and therapist salary as a separate line item.

- Add an inline ExplainButton near the breakdown summary:
  - `sectionId={HELP_SECTION_IDS.rates}`

Do NOT change the existing `data-testid` for the primary stats values.
  </action>
  <verify>pnpm -s run test:unit</verify>
  <done>
- StatsTab includes two disclosure blocks for rate breakdowns.
- ExplainButton opens Help to the rates section.
- Unit tests still pass.
  </done>
</task>

</tasks>

<verification>
- `pnpm -s run typecheck`
- `pnpm -s run test:unit`
</verification>

<success_criteria>
- Players can see a base + modifiers breakdown for both enjoyment/sec and dollars/sec.
- The breakdown explicitly shows event multiplier and softcap efficiency.
</success_criteria>

<output>
After completion, create `.planning/phases/21-explanations-and-rate-transparency/21-04-SUMMARY.md`
</output>
