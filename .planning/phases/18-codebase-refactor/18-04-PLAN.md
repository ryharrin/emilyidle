---
phase: 18-codebase-refactor
plan: 4
type: execute
wave: 1
depends_on: []
files_modified:
  - src/App.tsx
  - src/ui/tabs/CollectionTab.tsx
  - src/ui/tabs/CareerTab.tsx
  - src/ui/tabs/WorkshopTab.tsx
  - src/ui/tabs/MaisonTab.tsx
  - src/ui/tabs/NostalgiaTab.tsx
  - src/ui/tabs/CatalogTab.tsx
  - src/ui/tabs/StatsTab.tsx
  - src/ui/tabs/SaveTab.tsx
autonomous: true

must_haves:
  truths:
    - "Primary navigation and all tab panels still render with the same ids/testids and accessible names"
    - "Tab switching (keyboard + click) still works"
    - "App.tsx becomes a smaller composition root (tabs extracted into src/ui/tabs/*)"
  artifacts:
    - path: "src/ui/tabs/CollectionTab.tsx"
      provides: "Collection panel JSX (keeps id='collection' and related selectors)"
    - path: "src/ui/tabs/NostalgiaTab.tsx"
      provides: "Nostalgia panel JSX (keeps nostalgia selectors + modal/results rendering)"
    - path: "src/App.tsx"
      provides: "Composition root wiring state/handlers to tab components"
  key_links:
    - from: "src/App.tsx"
      to: "src/ui/tabs/CollectionTab.tsx"
      via: "React component"
      pattern: "<CollectionTab"
    - from: "src/ui/tabs/CollectionTab.tsx"
      to: "tests/*.spec.ts"
      via: "stable selectors"
      pattern: "id=\\\"collection\\\""
    - from: "src/ui/tabs/CareerTab.tsx"
      to: "tests/*.spec.ts"
      via: "stable selectors"
      pattern: "id=\\\"career\\\""
    - from: "src/ui/tabs/WorkshopTab.tsx"
      to: "tests/*.spec.ts"
      via: "stable selectors"
      pattern: "id=\\\"workshop\\\""
    - from: "src/ui/tabs/MaisonTab.tsx"
      to: "tests/*.spec.ts"
      via: "stable selectors"
      pattern: "id=\\\"maison\\\""
    - from: "src/ui/tabs/NostalgiaTab.tsx"
      to: "tests/*.spec.ts"
      via: "stable selectors"
      pattern: "id=\\\"nostalgia\\\""
    - from: "src/ui/tabs/CatalogTab.tsx"
      to: "tests/*.spec.ts"
      via: "stable selectors"
      pattern: "id=\\\"catalog\\\""
    - from: "src/ui/tabs/StatsTab.tsx"
      to: "tests/*.spec.ts"
      via: "stable selectors"
      pattern: "id=\\\"stats\\\""
    - from: "src/ui/tabs/SaveTab.tsx"
      to: "tests/*.spec.ts"
      via: "stable selectors"
      pattern: "id=\\\"save\\\""
---

<objective>
Extract each major tab/panel from `src/App.tsx` into `src/ui/tabs/*` components while preserving the DOM selector contracts used by tests.

Purpose: Make UI easier to navigate and change without touching the whole app file.
Output: New tab components and a slimmer `src/App.tsx` that composes them.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/18-codebase-refactor/18-CONTEXT.md
@.planning/phases/18-codebase-refactor/18-RESEARCH.md

@src/App.tsx

@tests/tabs.spec.ts
@tests/collection-loop.spec.ts
@tests/nostalgia-prestige.spec.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create src/ui/tabs/* components and move each tabpanel JSX out of App.tsx</name>
  <files>
src/App.tsx
src/ui/tabs/CollectionTab.tsx
src/ui/tabs/CareerTab.tsx
src/ui/tabs/WorkshopTab.tsx
src/ui/tabs/MaisonTab.tsx
src/ui/tabs/NostalgiaTab.tsx
src/ui/tabs/CatalogTab.tsx
src/ui/tabs/StatsTab.tsx
src/ui/tabs/SaveTab.tsx
  </files>
  <action>
- Create `src/ui/tabs` if it does not exist.
- Define prop types locally in each tab component; avoid shared types unless reuse is clearly beneficial.
- For each major tab panel currently rendered in `src/App.tsx`, create a corresponding component under `src/ui/tabs/*Tab.tsx`.
  - Move the tabpanel JSX into the component.
  - Keep the tabpanel `id` attributes exactly the same (`collection`, `career`, `workshop`, `maison`, `nostalgia`, `catalog`, `stats`, `save`).
  - Keep `role="tabpanel"` and `aria-labelledby` wiring identical.
  - Keep all `data-testid` attributes used by tests unchanged.
- In `src/App.tsx`, replace the extracted JSX with `<CollectionTab ... />` etc and pass the existing state + handlers as props.
- Do not change styling beyond what is necessary to preserve layout and selectors.
  </action>
  <verify>pnpm run typecheck</verify>
  <done>
- `src/App.tsx` no longer contains the bulk of each tabpanel JSX.
- Tab ids/testids are unchanged.
- `pnpm run typecheck` succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Stabilize imports and ensure tests still locate all panels and core controls</name>
  <files>
src/App.tsx
  </files>
  <action>
- Run unit + e2e tests and fix any selector/aria/DOM structure regressions caused by the refactor.
- Treat Playwright tests as contracts: prefer restoring selectors/aria wiring in the UI so `tests/*.spec.ts` stays unchanged; only update tests when preserving the selector is truly unreasonable.
- If tests must change to keep selectors stable, stop and create a follow-up plan scoped to those test files.
- Keep accessible names (tab labels) stable unless tests are updated accordingly.
  </action>
  <verify>pnpm run test:unit && pnpm run test:e2e</verify>
  <done>
- `pnpm run test:unit` succeeds with the new `src/ui/tabs/*` split.
- `pnpm run test:e2e` succeeds (selectors, aria wiring, and tab switching remain stable).
  </done>
</task>

</tasks>

<verification>
- `pnpm run typecheck`
- `pnpm run test:unit`
- `pnpm run test:e2e`
</verification>

<success_criteria>
- UI code is split into per-tab components with stable test selectors.
- `src/App.tsx` reads as the app composition root rather than a monolith.
</success_criteria>

<output>
After completion, create `.planning/phases/18-codebase-refactor/18-04-SUMMARY.md`
</output>
