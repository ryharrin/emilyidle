---
phase: 18-codebase-refactor
plan: 6
type: execute
wave: 4
depends_on: ["03", "04", "05"]
files_modified:
  - AGENTS.md
  - src/AGENTS.md
  - src/game/AGENTS.md
  - tests/AGENTS.md
  - src/App.tsx
  - src/game/state.ts
autonomous: true

must_haves:
  truths:
    - "No dead/unused code remains from the refactor (lint passes)"
    - "Internal docs describe the new module boundaries (UI vs runtime vs domain)"
  artifacts:
    - path: "AGENTS.md"
      provides: "Top-level repo guidance aligned with new structure"
    - path: "src/game/AGENTS.md"
      provides: "Game module layout guidance (model/data/selectors/actions/runtime)"
    - path: "src/AGENTS.md"
      provides: "UI structure guidance (src/ui/*)"
  key_links:
    - from: "AGENTS.md"
      to: "src/ui"
      via: "documentation reference"
      pattern: "src/ui"
    - from: "src/game/AGENTS.md"
      to: "src/game/model"
      via: "documentation reference"
      pattern: "src/game/model"
---

<objective>
Finish the refactor by cleaning up dead code and updating internal docs to match the new structure.

Purpose: Make the new module boundaries maintainable and remove refactor fallout.
Output: Clean codebase + updated docs aligned with Phase 18's new structure.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/18-codebase-refactor/18-CONTEXT.md
@.planning/phases/18-codebase-refactor/18-RESEARCH.md

@AGENTS.md
@src/AGENTS.md
@src/game/AGENTS.md
@tests/AGENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove dead/unused code introduced by moves and fix lint violations</name>
  <files>
src/App.tsx
src/game/state.ts
  </files>
  <action>
- Delete or inline any now-unused helpers left behind from the split (unused constants/functions/imports).
- Remove any duplicated logic created by the tab extraction or runtime hook extraction.
- Prefer small, mechanical cleanups; do not change gameplay behavior unless it is an obvious correctness bug discovered during refactor.
  </action>
  <verify>pnpm run lint</verify>
  <done>
- `pnpm run lint` succeeds with no new eslint/prettier issues.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update internal AGENTS docs to reflect the new structure</name>
  <files>
AGENTS.md
src/AGENTS.md
src/game/AGENTS.md
tests/AGENTS.md
  </files>
  <action>
- Update these docs to match the new layout:
  - `src/ui/tabs/*` owns tabpanel rendering.
  - `src/game/runtime/*` owns RAF/autosave/lifecycle side effects.
  - `src/game/model/*` defines GameState and state construction.
  - `src/game/data/*`, `src/game/selectors/*`, `src/game/actions/*` contain game rules.
- Keep guidance focused on “where to put code” and key invariants (selectors purity, persistence contract, test selector stability).
  </action>
  <verify>pnpm run typecheck</verify>
  <done>
- Docs explicitly mention the new directories and constraints.
- `pnpm run typecheck` still succeeds after any doc-linked import path changes made during cleanup.
  </done>
</task>

</tasks>

<verification>
- `pnpm run lint`
- `pnpm run typecheck`
</verification>

<success_criteria>
- Codebase has clear module boundaries: UI tabs, runtime orchestration, domain model/data/selectors/actions.
- Lint and typecheck gates pass after cleanup and doc updates.
</success_criteria>

<output>
After completion, create `.planning/phases/18-codebase-refactor/18-06-SUMMARY.md`
</output>
