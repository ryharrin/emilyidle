---
phase: 19-refactor-phase-13-code-with-phase-13-research-in-mind
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/game/selectors/enjoyment.ts
  - src/game/selectors/index.ts
autonomous: true

must_haves:
  truths:
    - "Enjoyment/sec remains derived from owned watches and scales by prestige legacy multiplier"
    - "Public state facade exports still provide enjoyment selectors used by UI and simulation"
  artifacts:
    - path: "src/game/selectors/enjoyment.ts"
      provides: "Dedicated enjoyment + prestige legacy selectors"
    - path: "src/game/selectors/index.ts"
      provides: "Barrel exports include enjoyment selectors"
  key_links:
    - from: "src/game/sim.ts"
      to: "getEnjoymentRateCentsPerSec"
      via: "import from src/game/state.ts facade"
      pattern: "getEnjoymentRateCentsPerSec"
    - from: "src/ui/tabs/CollectionTab.tsx"
      to: "getWatchItemEnjoymentRateCentsPerSec"
      via: "import from src/game/state.ts facade"
      pattern: "getWatchItemEnjoymentRateCentsPerSec"
---

<objective>
Extract the Phase 13 enjoyment economy selectors into a dedicated module to make the faucet/drain rules easier to reason about (per Phase 13 research), without changing gameplay.

Purpose: Reduce coupling and improve navigation/maintainability of enjoyment logic.
Output: A focused enjoyment selector module + stable barrel exports.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/13-enjoyment-economy-foundation/13-RESEARCH.md
@.planning/phases/13-enjoyment-economy-foundation/13-01-SUMMARY.md
@.planning/phases/18-codebase-refactor/18-03-SUMMARY.md

@src/game/selectors/index.ts
@src/game/data/items.ts
@src/game/state.ts
@src/game/sim.ts
@src/ui/tabs/CollectionTab.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract enjoyment selectors into src/game/selectors/enjoyment.ts</name>
  <files>
src/game/selectors/enjoyment.ts
src/game/selectors/index.ts
  </files>
  <action>
- Create `src/game/selectors/enjoyment.ts` and move ONLY the Phase 13 enjoyment-related selectors/helpers into it:
  - `getWatchItemEnjoymentRateCentsPerSec`
  - `getEnjoymentCents`
  - `getPrestigeLegacyMultiplier`
  - `getEnjoymentRateCentsPerSec`
  - `getEnjoymentThresholdLabel`
- Preserve behavior and exports exactly (no renames, no logic changes).
- Update `src/game/selectors/index.ts` to:
  - re-export the new module (so `src/game/state.ts` continues to expose the same API)
  - import from `./enjoyment` anywhere the old in-file functions were referenced
- Avoid circular imports: enjoyment module should import only types/data/format helpers; it must not import from `src/game/state.ts`.
  </action>
  <verify>
pnpm run typecheck
  </verify>
  <done>
- New module exists and is referenced by the selectors barrel.
- Typecheck passes with no new TS errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify no behavior regressions in enjoyment economy</name>
  <files>
src/game/selectors/enjoyment.ts
src/game/selectors/index.ts
  </files>
  <action>
- Run the existing automated checks that would catch selector/export regressions.
- If any tests fail due to import paths or moved symbols, fix by adjusting exports/imports (NOT by weakening tests).
  </action>
  <verify>
pnpm run lint
pnpm run test:unit
  </verify>
  <done>
- Lint and unit tests pass.
- The UI and simulation still compile against `src/game/state.ts` exports.
  </done>
</task>

</tasks>

<verification>
- `pnpm run lint` passes
- `pnpm run typecheck` passes
- `pnpm run test:unit` passes
</verification>

<success_criteria>
- Enjoyment-related selectors are located in `src/game/selectors/enjoyment.ts` and still exported via `src/game/state.ts`.
- No behavior changes are introduced (refactor-only).
</success_criteria>

<output>
After completion, create `.planning/phases/19-refactor-phase-13-code-with-phase-13-research-in-mind/19-01-SUMMARY.md`
</output>
