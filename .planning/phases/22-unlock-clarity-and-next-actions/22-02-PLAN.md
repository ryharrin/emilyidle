---
phase: 22-unlock-clarity-and-next-actions
plan: 02
type: execute
wave: 1
depends_on:
  - 21-06
files_modified:
  - src/ui/components/UnlockHint.tsx
  - src/ui/components/NextUnlockPanel.tsx
  - src/ui/components/EmptyStateCTA.tsx
  - src/style.css
  - tests/unlock-components.unit.test.tsx
autonomous: true

must_haves:
  truths:
    - "A single reusable UI pattern renders lock reason + progress + one next action"
    - "Empty states can render one clear CTA without bespoke per-tab styling"
  artifacts:
    - path: "src/ui/components/NextUnlockPanel.tsx"
      provides: "List UI for upcoming unlocks"
    - path: "src/ui/components/UnlockHint.tsx"
      provides: "Lock/progress row with optional CTA"
    - path: "src/ui/components/EmptyStateCTA.tsx"
      provides: "Empty state copy + single CTA button"
  key_links:
    - from: "src/ui/components/NextUnlockPanel.tsx"
      to: "src/ui/components/UnlockHint.tsx"
      via: "composition"
      pattern: "<UnlockHint"
---

<objective>
Create shared UI primitives for Phase 22: unlock hints (reason + progress + next action), a Collection-visible “Next unlocks” panel, and a reusable empty-state CTA.

Purpose: Standardize unlock clarity UX across tabs without changing underlying gating rules.
Output: New reusable components + minimal CSS + unit tests.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/22-unlock-clarity-and-next-actions/22-RESEARCH.md

@src/style.css
@src/ui/tabs/WorkshopTab.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add unlock hint + next unlock panel components</name>
  <files>
src/ui/components/UnlockHint.tsx
src/ui/components/NextUnlockPanel.tsx
src/ui/components/EmptyStateCTA.tsx
  </files>
  <action>
Create `src/ui/components/` and implement three components.

1) `src/ui/components/UnlockHint.tsx`
- Renders:
  - a short label (eg "Locked" / "Next unlock")
  - the requirement label text
  - a progress line `current / threshold` and a percent (derived from ratio)
  - a progress bar using existing `.teaser-track` + `.teaser-fill` classes
  - optional CTA button (`button.secondary`) if `cta` provided
- Props (exported types ok):
  - `eyebrow: string`
  - `title: string`
  - `detail: string` (requirement label)
  - `currentLabel: string`
  - `thresholdLabel: string`
  - `ratio: number` (already clamped 0..1)
  - `cta?: { label: string; onClick: () => void; testId?: string }`

2) `src/ui/components/NextUnlockPanel.tsx`
- Renders a `section.panel` with:
  - header: eyebrow "Progress", title "Next unlocks", and muted explanation line.
  - list of `UnlockHint` entries.
- Props:
  - `items: ReadonlyArray<...>` (define a local type `NextUnlockItem` that contains `id` plus the `UnlockHint` props).
- Add stable test ids:
  - panel root: `data-testid="next-unlocks"`
  - each row: `data-testid="next-unlock-${id}"`

3) `src/ui/components/EmptyStateCTA.tsx`
- Renders a compact empty state block:
  - title (h4)
  - body (p.muted)
  - single CTA button
- Props: `title`, `body`, `ctaLabel`, `onCta`, optional `testId`.

Do not import from `src/App.tsx` (keep components reusable). Keep ids/data-testid stable.
  </action>
  <verify>pnpm run typecheck</verify>
  <done>
Components compile, have stable test ids, and render without needing new dependencies.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add minimal styling + unit tests for component rendering</name>
  <files>
src/style.css
tests/unlock-components.unit.test.tsx
  </files>
  <action>
In `src/style.css`, add minimal classes to make the new blocks consistent with existing panels:
- `.unlock-hint` spacing (gap between text and progress bar)
- `.unlock-hint-header` layout (title left, percent right)
- `.unlock-hint-progress` text styling (muted, small)
- Ensure progress bar uses existing `.teaser-track` / `.teaser-fill`.

Create `tests/unlock-components.unit.test.tsx`:
- Render `NextUnlockPanel` with 2 items and assert:
  - panel `data-testid="next-unlocks"` exists
  - each item `data-testid` exists
- Render an `UnlockHint` with CTA and assert button click calls handler.
- Render `EmptyStateCTA` and assert CTA click calls handler.
  </action>
  <verify>pnpm run test:unit tests/unlock-components.unit.test.tsx</verify>
  <done>
Components are styled enough to be readable and tests prove rendering + CTA wiring.
  </done>
</task>

</tasks>

<verification>
- `pnpm run lint`
- `pnpm run test:unit`
</verification>

<success_criteria>
- UI has a single reusable “unlock hint” primitive, used later to satisfy CLAR-01/04.
</success_criteria>

<output>
After completion, create `.planning/phases/22-unlock-clarity-and-next-actions/22-02-SUMMARY.md`
</output>
