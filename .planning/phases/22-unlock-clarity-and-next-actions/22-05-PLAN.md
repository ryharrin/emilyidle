---
phase: 22-unlock-clarity-and-next-actions
plan: 05
type: execute
wave: 4
depends_on:
  - 22-03
  - 22-04
files_modified:
  - tests/unlock-clarity.spec.ts
autonomous: false

must_haves:
  truths:
    - "Next unlocks panel is visible in Vault and lists locked tabs/systems"
    - "Catalog empty states provide a single CTA back to Vault"
  artifacts:
    - path: "tests/unlock-clarity.spec.ts"
      provides: "Playwright coverage for next unlock panel + empty state navigation"
  key_links:
    - from: "tests/unlock-clarity.spec.ts"
      to: "src/ui/components/NextUnlockPanel.tsx"
      via: "data-testid assertions"
      pattern: "next-unlocks"
---

<objective>
Add automated e2e coverage for Phase 22 unlock clarity UX and perform a single human verification pass for copy/layout.

Purpose: Prevent regressions in unlock guidance and CTA navigation.
Output: New Playwright spec + one human verification checkpoint.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@tests/tabs.spec.ts
@src/App.tsx
@src/ui/tabs/CollectionTab.tsx
@src/ui/tabs/CatalogTab.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Playwright coverage for next unlocks + catalog empty CTA navigation</name>
  <files>tests/unlock-clarity.spec.ts</files>
  <action>
Create `tests/unlock-clarity.spec.ts` with two tests using `page.addInitScript` (follow `tests/tabs.spec.ts` pattern):

Test A: "vault shows next unlocks panel for hidden systems"
- Seed a minimal save with:
  - 0 milestones unlocked
  - 0 items owned
  - required nested objects matching `tests/tabs.spec.ts` keys (keep persistence shape stable)
- Visit `/`.
- Assert `data-testid="next-unlocks"` is visible.
- Assert at least one row exists via `data-testid` prefix (eg `next-unlock-career`).
- Assert the CTA button exists and is labeled "Buy watches" (or whatever the implementation uses consistently).

Test B: "catalog empty state CTA returns to vault"
- Seed a save where Catalog tab is visible:
  - set `items.chronograph = 2` (gives enough Memories to satisfy reveal ratio)
  - keep `discoveredCatalogEntries = []`
- Visit `/`.
- Click the "Catalog" tab.
- Assert the discovered empty state block exists (keep using the existing stable `data-testid`).
- Click its CTA and assert the "Vault" tab is selected (aria-selected true).

Do not assert scroll position (too brittle); only assert navigation selection.
  </action>
  <verify>pnpm run test:e2e -- --project=chromium tests/unlock-clarity.spec.ts</verify>
  <done>
Playwright tests pass and validate the two most important Phase 22 UX guarantees.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Unlock clarity UX (Next unlocks panel, lock reason rows, catalog empty CTAs)</what-built>
  <how-to-verify>
1) Run `pnpm dev`.
2) On a fresh save, open Vault and confirm the "Next unlocks" panel is visible and readable.
3) Confirm locked watch cards (eg Classic Automatic) show an unlock requirement + progress even before the tab for the system is revealed.
4) Navigate to Catalog (once visible) and confirm empty states explain what the Catalog is for and provide one clear CTA back to Vault.
5) Repeat steps 2-4 on a narrow viewport (mobile responsive) to ensure layout remains usable.
  </how-to-verify>
  <resume-signal>Type "approved" or describe the issues to fix</resume-signal>
</task>

</tasks>

<verification>
- `pnpm run lint`
- `pnpm run typecheck`
- `pnpm run test:unit`
- `pnpm run test:e2e`
</verification>

<success_criteria>
- Phase 22 UX is covered by automated tests and confirmed usable by a human pass.
</success_criteria>

<output>
After completion, create `.planning/phases/22-unlock-clarity-and-next-actions/22-05-SUMMARY.md`
</output>
