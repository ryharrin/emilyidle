---
phase: 12-major-updates-01-21
plan: 07
type: execute
---

<objective>
Add tutorial coachmarks and dev mode controls to improve onboarding and testing.

Purpose: Guide new players while enabling safe debugging tools for development.
Output: Coachmark UI with persistence and a dev mode panel with tests.
</objective>

<execution_context>
~/.config/opencode/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-major-updates-01-21/12-RESEARCH.md
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/TESTING.md
@NOTES.md
@.sisyphus/plans/notes-planned-features.md
@src/App.tsx
@src/style.css
@tests/catalog.unit.test.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and polish coachmarks with dismiss persistence</name>
  <files>src/App.tsx, src/style.css, tests/catalog.unit.test.tsx</files>
  <action>Coachmarks are already implemented as a side-panel panel in `src/App.tsx` (and dismissed state is persisted in settings). Start by verifying the current coachmarks list covers the intended onboarding areas and that dismissals persist.

Polish work to do (keep it lightweight; do NOT add new dependencies unless absolutely required):
- Ensure the coachmarks copy covers the intended sections (Vault, Catalog, Atelier, Maison, prestige concepts, set bonuses, crafting).
- Ensure coachmarks are not shown if all coachmarks are dismissed.
- Ensure dismiss action persists immediately via the existing settings persistence helper.
- If there are new coachmarks to add, add them as new IDs (do not rename existing IDs unless you also migrate old keys).

Update unit tests to cover any additions/changes and keep selectors stable (`data-testid="coachmarks"` and `data-testid="coachmark"`).</action>
  <verify>pnpm run test:unit -- --run tests/catalog.unit.test.tsx</verify>
  <done>Coachmarks render on a fresh save, and dismissed coachmarks remain dismissed across reloads via settings persistence.</done>
</task>

<task type="auto">
  <name>Task 2: Audit and expand dev mode controls (safely gated)</name>
  <files>src/App.tsx, src/game/state.ts, tests/catalog.unit.test.tsx</files>
  <action>Dev mode is already enabled via URL search params in `src/App.tsx` (`new URLSearchParams(window.location.search)` + `params.has("dev")`) and currently exposes some controls in the Save tab.

Update the plan to match current best practices from `12-RESEARCH.md`:
- Keep runtime gating via `?dev` (support `?dev=1` as well since `params.has("dev")` treats both as enabled).
- Consider build-time gating for destructive actions using `import.meta.env.DEV` (so GitHub Pages production builds do not ship save-corrupting debug controls by accident). If you add build-time gating, ensure tests run in an environment where `import.meta.env.DEV` is true, or make the gating conditional only for the most destructive actions.
- Ensure dev UI is clearly labeled (banner or obvious label) when active.
- Ensure dev controls are inert / not rendered when dev mode is off.
- If the current controls do not cover key test flows, add narrowly-scoped actions (e.g., grant cash/enjoyment, unlock milestones/tabs, reset save, adjust sim speed) using existing state helpers where possible.

Update/add unit tests verifying:
- dev mode toggles on when URL includes `?dev`.
- key actions modify state only when dev mode is active.</action>
  <verify>pnpm run test:unit -- --run tests/catalog.unit.test.tsx</verify>
  <done>Dev mode activates via URL flag, is clearly labeled, and dev actions are gated so they cannot mutate state unless dev mode is enabled.</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `pnpm run test:unit`
- [ ] Manual smoke check: coachmarks show on fresh save, dev mode banner appears with `?dev=1`
</verification>

<success_criteria>
- Coachmarks provide guided context and persist dismissal state
- Dev mode banner + controls work only when enabled
  </success_criteria>

<output>
After completion, create `.planning/phases/12-major-updates-01-21/12-07-SUMMARY.md`:

# Phase 12 Plan 07 Summary

**Added coachmarks and dev mode tooling.**

## Accomplishments
- [ ] ...

## Files Created/Modified
- `src/App.tsx` - ...
- `src/style.css` - ...
- `src/game/state.ts` - ...
- `tests/catalog.unit.test.tsx` - ...

## Decisions Made
- None

## Issues Encountered
- None

## Next Step
- Ready for 12-08-PLAN.md
</output>
