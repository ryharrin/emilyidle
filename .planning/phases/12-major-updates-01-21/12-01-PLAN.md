---
phase: 12-major-updates-01-21
plan: 01
type: execute
---

<objective>
Align progress gating rules to the 80% reveal threshold and enforce primary tab visibility based on unlock progress.

Purpose: Reduce UI clutter for early players while preserving clear unlock cues.
Output: Updated reveal helpers and tab gating logic with unit + e2e coverage.
</objective>

<execution_context>
~/.config/opencode/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@NOTES.md
@.sisyphus/plans/notes-planned-features.md
@src/game/state.ts
@src/App.tsx
@tests/maison.unit.test.tsx
@tests/catalog.unit.test.tsx
@tests/collection-loop.spec.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Confirm 80% reveal threshold and update unlock-tag tests</name>
  <files>src/game/state.ts, tests/maison.unit.test.tsx</files>
  <action>Ensure REVEAL_THRESHOLD_RATIO is 0.8 and all reveal helpers (workshop/maison/milestone/achievement) consistently use it. Update the reveal-focused unit test to assert 0.8 boundaries (below vs at/above). Do not change milestone thresholds or unlock criteria.</action>
  <verify>pnpm run test:unit -- --run tests/maison.unit.test.tsx</verify>
  <done>Reveal helpers return false below 80% and true at 80% for workshop, maison, milestone, and achievement cases.</done>
</task>

<task type="auto">
  <name>Task 2: Gate primary tabs by near-unlock progress</name>
  <files>src/App.tsx, tests/catalog.unit.test.tsx</files>
  <action>Hide Catalog/Stats/Atelier/Maison tabs until their gating criteria are met. Use existing helpers: milestone progress for Catalog (showcase), achievement progress for Stats (first achievement), and isWorkshopRevealReady/isMaisonRevealReady for Atelier/Maison. Ensure hidden tabs are removed from tablist and keyboard navigation. Update unit tests to cover fresh save and near-unlock states.</action>
  <verify>pnpm run test:unit -- --run tests/catalog.unit.test.tsx</verify>
  <done>Fresh save shows only Vault + Save tabs; near-unlock states reveal the correct tabs without breaking tablist behavior.</done>
</task>

<task type="auto">
  <name>Task 3: Update e2e navigation for gated tabs</name>
  <files>tests/collection-loop.spec.ts</files>
  <action>Adjust Playwright tests to seed localStorage so gated tabs appear when needed, and navigate via the visible tabs before interacting with Catalog/Atelier/Maison content. Keep selectors stable.</action>
  <verify>pnpm run test:e2e -- --project=chromium --grep "collection"</verify>
  <done>E2E navigation succeeds without relying on hidden tabs.</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `pnpm run test:unit`
- [ ] `pnpm run test:e2e`
</verification>

<success_criteria>
- All reveal helpers use the 80% threshold consistently
- Primary tabs hide/show based on unlock progress without breaking navigation
- Unit and E2E tests pass for gated tab flows
  </success_criteria>

<output>
After completion, create `.planning/phases/12-major-updates-01-21/12-01-SUMMARY.md`:

# Phase 12 Plan 01 Summary

**Aligned reveal gating and primary tab visibility to 80% progress.**

## Accomplishments
- [ ] ...

## Files Created/Modified
- `src/game/state.ts` - ...
- `src/App.tsx` - ...
- `tests/maison.unit.test.tsx` - ...
- `tests/catalog.unit.test.tsx` - ...
- `tests/collection-loop.spec.ts` - ...

## Decisions Made
- None

## Issues Encountered
- None

## Next Step
- Ready for 12-02-PLAN.md
</output>
