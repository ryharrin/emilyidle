---
phase: 12-major-updates-01-21
plan: 05
type: execute
---

<objective>
Introduce the crafting system core: parts resource, dismantle flow, craft recipes, and persistence.

Purpose: Add meaningful mid-game depth through crafting mechanics.
Output: Crafting state + logic, persistence updates, and unit tests.
</objective>

<execution_context>
~/.config/opencode/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-major-updates-01-21/12-RESEARCH.md
@NOTES.md
@.sisyphus/plans/notes-planned-features.md
@src/game/state.ts
@src/game/persistence.ts
@tests/maison.unit.test.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add crafting state and core mechanics</name>
  <files>src/game/state.ts</files>
  <action>Add crafting fields (parts, recipes, crafted inventory) to game state and implement helper functions for dismantling owned watches into parts and crafting new items/bonuses. Ensure effects are deterministic and consistent with existing multiplier pipelines. Avoid touching save keys unrelated to crafting.</action>
  <verify>pnpm run test:unit -- --run tests/maison.unit.test.tsx</verify>
  <done>Core crafting helpers return expected results for dismantle/craft flows.</done>
</task>

<task type="auto">
  <name>Task 2: Persist crafting state with defensive loading</name>
  <files>src/game/persistence.ts, tests/maison.unit.test.tsx</files>
  <action>Extend save/load to include crafting fields, following existing defensive parsing patterns. Add unit tests covering valid payloads, missing fields, and invalid data defaults. If needed, add a dedicated crafting unit test file.</action>
  <verify>pnpm run test:unit</verify>
  <done>Crafting data persists and loads safely without breaking legacy saves.</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `pnpm run test:unit`
</verification>

<success_criteria>
- Crafting state and helpers exist in core game logic
- Persistence round-trips crafting data with safe defaults
- Unit tests cover dismantle/craft logic and persistence
  </success_criteria>

<output>
After completion, create `.planning/phases/12-major-updates-01-21/12-05-SUMMARY.md`:

# Phase 12 Plan 05 Summary

**Implemented core crafting logic and persistence.**

## Accomplishments
- [ ] ...

## Files Created/Modified
- `src/game/state.ts` - ...
- `src/game/persistence.ts` - ...
- `tests/maison.unit.test.tsx` - ...

## Decisions Made
- None

## Issues Encountered
- None

## Next Step
- Ready for 12-06-PLAN.md
</output>
