---
phase: 01-bugfixes
type: execute
---

<objective>
Fix the small developer-facing bugs currently visible in this repo (invalid markup and unit-test warnings).

Purpose: Improve standards compliance and keep tests warning-free so failures remain high-signal.
Output: Updated `src/App.tsx`, updated `NOTES.md` bugfix section, and clean unit/e2e runs.
</objective>

<execution_context>
~/.config/opencode/get-shit-done/workflows/execute-phase.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@NOTES.md

@src/App.tsx
@tests/catalog.unit.test.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace invalid &lt;search&gt; container with standards-compliant markup</name>
  <files>src/App.tsx</files>
  <action>
Replace the `&lt;search className="catalog-filters" ...&gt;` wrapper in the catalog panel with a standards-compliant element.

Constraints:
- Preserve `className="catalog-filters"` and `data-testid="catalog-filters"`.
- Preserve visual layout and existing behavior (this is a markup fix, not a redesign).

Recommended approach:
- Use `&lt;form role="search" ...&gt;` (or `&lt;div role="search" ...&gt;`) and ensure it does not cause navigation on Enter.
- If using a `form`, add `onSubmit={(e) =&gt; e.preventDefault()}`.
  </action>
  <verify>
Run `pnpm run test:unit` and confirm the output no longer includes the warning about an unrecognized `&lt;search&gt;` tag.
  </verify>
  <done>
- `pnpm run test:unit` output contains no `The tag &lt;search&gt; is unrecognized` warning.
- Catalog filter UI still renders and is still located by `data-testid="catalog-filters"`.
  </done>
</task>

<task type="auto">
  <name>Task 2: Eliminate React act() warnings in unit tests by preventing background simulation during Vitest runs</name>
  <files>src/App.tsx</files>
  <action>
Unit tests currently emit React warnings:
- "An update to App inside a test was not wrapped in act(...)"

This is almost certainly caused by the `requestAnimationFrame` simulation loop and/or autosave behavior scheduling async state updates after mount.

Implement a test-only guard so the `useEffect(() =&gt; requestAnimationFrame(...), [])` loop does not start when running under Vitest.

Constraints:
- Do not change gameplay behavior in dev/prod builds.
- Keep the guard narrowly scoped to the loop/autosave side effects.
- Prefer Vite-provided environment checks (e.g., `import.meta.env.MODE === "test"`).

Avoid:
- Disabling simulation globally.
- Changing test selectors or tab semantics.
  </action>
  <verify>
Run `pnpm run test:unit` and confirm it completes with **no act() warnings** in output.
  </verify>
  <done>
- `pnpm run test:unit` prints no `not wrapped in act(...)` warnings.
- `pnpm run test:e2e` still passes.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update NOTES.md with the bugfix list that was implemented</name>
  <files>NOTES.md</files>
  <action>
Populate the "Bug fixes:" section in `NOTES.md` with the concrete bugfix items addressed in Tasks 1-2.

Constraints:
- Keep it short and specific.
- Use bullet points with enough detail to understand what was fixed and why.
  </action>
  <verify>
Open `NOTES.md` and confirm the bugfix list is present and matches the work done.
  </verify>
  <done>
- `NOTES.md` includes a non-empty Bug fixes list matching the implemented fixes.
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `pnpm run lint` passes
- [ ] `pnpm run typecheck` passes
- [ ] `pnpm run test:unit` passes with no warnings related to this phase
- [ ] `pnpm run test:e2e` passes
</verification>

<success_criteria>

- Unit test output is warning-free for the issues targeted in this phase
- Markup uses standards-compliant elements (no custom-element warnings)
- Notes accurately reflect the bugfixes shipped
  </success_criteria>

<output>
After completion, create `.planning/phases/01-bugfixes/01-01-SUMMARY.md` using `~/.config/opencode/get-shit-done/templates/summary.md`.
</output>
